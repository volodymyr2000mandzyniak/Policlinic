<%# app/views/doctors/registrations/new.html.erb %>
<div class="registration-form">
  <h2>Реєстрація лікаря</h2>

  <%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>
    <%= render "doctors/shared/error_messages", resource: resource %>

    <div class="form-group">
      <%= f.label :email, "Електронна пошта*" %>
      <%= f.email_field :email, required: true, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :first_name, "Ім'я*" %>
      <%= f.text_field :first_name, required: true, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :last_name, "Прізвище*" %>
      <%= f.text_field :last_name, required: true, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :date_of_birth, "Дата народження*" %>
      <%= f.date_field :date_of_birth, required: true, class: "form-control", max: Date.today - 18.years %>
    </div>

    <div class="form-group">
      <%= f.label :address, "Адреса*" %>
      <%= f.text_field :address, required: true, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :phone, "Телефон*" %>
      <div class="input-group">
        <span class="input-group-text">+380</span>
        <%= f.text_field :phone, required: true, class: "form-control", placeholder: "961234567", id: "doctor_phone", inputmode: "tel", maxlength: 9 %>
      </div>
      <small class="form-text text-muted">Введіть 9 цифр після +380</small>
    </div>

    <div class="form-group">
      <%= f.label :category_id, "Спеціальність*" %>
      <%= f.collection_select :category_id, Category.all, :id, :title,
                            { prompt: "Оберіть вашу спеціальність" },
                            { class: "form-control", required: true } %>
    </div>

    <div class="form-group">
      <%= f.label :password, "Пароль*" %>
      <% if @minimum_password_length %>
        <small class="form-text text-muted">(мінімум <%= @minimum_password_length %> символів)</small>
      <% end %>
      <%= f.password_field :password, required: true, class: "form-control" %>
    </div>

    <div class="form-group">
      <%= f.label :password_confirmation, "Підтвердження пароля*" %>
      <%= f.password_field :password_confirmation, required: true, class: "form-control" %>
    </div>

    <div class="actions">
      <%= f.submit "Зареєструватися", class: "btn btn-primary btn-block" %>
    </div>
  <% end %>

  <div class="shared-links">
    <%= render "doctors/shared/links" %>
  </div>
</div>

<style>
.registration-form {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.form-group {
  margin-bottom: 1.5rem;
}
.form-control {
  display: block;
  width: 100%;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  line-height: 1.5;
  color: #495057;
  background-color: #fff;
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
}
.input-group-text {
  background-color: #e9ecef;
  border: 1px solid #ced4da;
  padding: 0.375rem 0.75rem;
  border-radius: 0.25rem 0 0 0.25rem;
}
.input-group .form-control {
  border-radius: 0 0.25rem 0.25rem 0;
}
.btn-block {
  display: block;
  width: 100%;
}
.shared-links {
  margin-top: 1.5rem;
  text-align: center;
}
</style>

<script>
document.addEventListener('turbo:load', function () {
  const form = document.querySelector('.registration-form form');
  const phoneInput = document.getElementById('doctor_phone');

  if (form && phoneInput) {
    form.addEventListener('submit', function (e) {
      let raw = phoneInput.value.trim().replace(/\D/g, '');

      if (raw.length === 9) {
        phoneInput.value = '+380' + raw;
      } else if (raw.length === 12 && raw.startsWith('380')) {
        phoneInput.value = '+' + raw;
      } else if (raw.length === 13 && raw.startsWith('380')) {
      } else {
        e.preventDefault();
        alert('Введіть коректний номер (9 цифр після +380)');
        phoneInput.focus();
      }
    });
  }
});
</script>
